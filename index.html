<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Novora</title>
    <meta name="description" content="Employee Engagement Platform" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="Novora" />
    <meta property="og:description" content="Employee Engagement Platform" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <link rel="icon" href="/favicon.png" type="image/png" sizes="32x32">
    <link rel="icon" href="/favicon.png" type="image/png" sizes="16x16">
    <link rel="shortcut icon" href="/favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="/favicon.png">
    <link rel="icon" href="/uploads/5b77ec96-2245-4206-9aa7-a6b00a8dea4c.png?v=1" type="image/png">
    
    <!-- Fixed config.js with production URLs -->
    <script>
      // API Configuration
      window.API_CONFIG = {
        // Production backend URL
        BASE_URL: 'https://novora.onrender.com',
        
        // Production frontend URL for survey links
        FRONTEND_URL: 'https://novorasurveys.com',
        
        // API endpoints
        ENDPOINTS: {
          AUTH: '/api/v1/auth',
          SURVEYS: '/api/v1/surveys',
          RESPONSES: '/api/v1/responses',
          HEALTH: '/api/v1/health'
        }
      };

      // Override hardcoded localhost URLs
      window.ENVIRONMENT_CONFIG = {
        VITE_API_URL: 'https://novora.onrender.com',
        VITE_FRONTEND_URL: 'https://novorasurveys.com',
        NODE_ENV: 'production'
      };

      // Production security guard - disable mock data and fix localhost URLs
      if (typeof window !== 'undefined') {
        // Block mock data in production
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
          window.USE_MOCK_DATA = false;
          window.MOCK_MODE = false;
          
          // Override any mock data functions
          if (window.mockData) {
            window.mockData = null;
          }
          if (window.getMockSurveys) {
            window.getMockSurveys = () => [];
          }
          if (window.getMockUser) {
            window.getMockUser = () => null;
          }
          
          // CRITICAL: Override hardcoded localhost URLs in compiled JS
          const originalFetch = window.fetch;
          window.fetch = function(url, options) {
            if (typeof url === 'string') {
              // Replace localhost:8000 with production backend
              url = url.replace('http://localhost:8000', 'https://novora.onrender.com');
              url = url.replace('https://localhost:8000', 'https://novora.onrender.com');
              // Replace localhost:3000 with production frontend
              url = url.replace('http://localhost:3000', 'https://novorasurveys.com');
              url = url.replace('https://localhost:3000', 'https://novorasurveys.com');
            }
            return originalFetch(url, options);
          };
          
          // Override XMLHttpRequest as well
          const originalXHROpen = XMLHttpRequest.prototype.open;
          XMLHttpRequest.prototype.open = function(method, url, ...args) {
            if (typeof url === 'string') {
              url = url.replace('http://localhost:8000', 'https://novora.onrender.com');
              url = url.replace('https://localhost:8000', 'https://novora.onrender.com');
              url = url.replace('http://localhost:3000', 'https://novorasurveys.com');
              url = url.replace('https://localhost:3000', 'https://novorasurveys.com');
            }
            return originalXHROpen.call(this, method, url, ...args);
          };
        }
        
        window.API_CONFIG = window.API_CONFIG;
        window.ENVIRONMENT_CONFIG = window.ENVIRONMENT_CONFIG;
      }
    </script>
    
    <!-- Inline the CSS to avoid loading issues -->
    <style>
      /* Inline critical CSS here - this will be the actual MVP styles */
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      #root {
        min-height: 100vh;
      }
      
      /* Add your MVP styles here */
      .mvp-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .mvp-header {
        text-align: center;
        padding: 40px 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        margin-bottom: 40px;
      }
      
      .mvp-title {
        font-size: 3rem;
        margin-bottom: 20px;
        font-weight: 300;
      }
      
      .mvp-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
      }
      
      .mvp-cta {
        margin-top: 30px;
      }
      
      .mvp-button {
        background: white;
        color: #667eea;
        padding: 15px 30px;
        border: none;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin: 0 10px;
        transition: transform 0.2s;
      }
      
      .mvp-button:hover {
        transform: translateY(-2px);
      }
      
      .mvp-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin: 60px 0;
      }
      
      .mvp-feature {
        text-align: center;
        padding: 30px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      }
      
      .mvp-feature h3 {
        color: #333;
        margin-bottom: 15px;
      }
      
      .mvp-feature p {
        color: #666;
        line-height: 1.6;
      }
    </style>
  </head>

  <body>
    <div id="root">
      <!-- MVP Landing Page Content -->
      <div class="mvp-container">
        <div class="mvp-header">
          <h1 class="mvp-title">Novora</h1>
          <p class="mvp-subtitle">Employee Engagement Platform</p>
          <div class="mvp-cta">
            <a href="#signin" class="mvp-button">Get Started</a>
            <a href="#learn-more" class="mvp-button">Learn More</a>
          </div>
        </div>
        
        <div class="mvp-features">
          <div class="mvp-feature">
            <h3>üìä Real-time Surveys</h3>
            <p>Create and distribute employee surveys instantly. Get real-time insights into your team's engagement and satisfaction.</p>
          </div>
          
          <div class="mvp-feature">
            <h3>üîê Secure Authentication</h3>
            <p>Enterprise-grade security with user authentication, role-based access, and data protection.</p>
          </div>
          
          <div class="mvp-feature">
            <h3>üìà Analytics Dashboard</h3>
            <p>Comprehensive analytics and reporting to track trends and measure employee engagement over time.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Simple JavaScript for basic functionality -->
    <script>
      // Basic MVP functionality
      console.log('Novora MVP loaded successfully');
      
      // Test backend connection
      fetch('https://novora.onrender.com/api/v1/health')
        .then(response => response.text())
        .then(data => {
          console.log('‚úÖ Backend connected:', data);
        })
        .catch(error => {
          console.error('‚ùå Backend connection failed:', error);
        });
      
      // Handle CTA buttons
      document.addEventListener('DOMContentLoaded', function() {
        const ctaButtons = document.querySelectorAll('.mvp-button');
        ctaButtons.forEach(button => {
          button.addEventListener('click', function(e) {
            if (this.textContent.includes('Get Started')) {
              // Redirect to sign in or show sign in form
              showSignInForm();
            }
          });
        });
      });
      
      function showSignInForm() {
        // Simple sign in form
        const root = document.getElementById('root');
        root.innerHTML = `
          <div class="mvp-container">
            <div style="max-width: 400px; margin: 50px auto; padding: 40px; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
              <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Sign In</h2>
              <form id="signinForm">
                <div style="margin-bottom: 20px;">
                  <label style="display: block; margin-bottom: 5px; color: #333;">Email:</label>
                  <input type="email" id="email" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;" required>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="display: block; margin-bottom: 5px; color: #333;">Password:</label>
                  <input type="password" id="password" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;" required>
                </div>
                <button type="submit" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin-bottom: 10px;">Sign In</button>
                <button type="button" onclick="showRegisterForm()" style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">Create Account</button>
                <div id="status" style="margin-top: 15px; text-align: center;"></div>
              </form>
            </div>
          </div>
        `;
        
        // Add form handler
        document.getElementById('signinForm').addEventListener('submit', handleSignIn);
      }
      
      function showRegisterForm() {
        const root = document.getElementById('root');
        root.innerHTML = `
          <div class="mvp-container">
            <div style="max-width: 400px; margin: 50px auto; padding: 40px; background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
              <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Create Account</h2>
              <form id="registerForm">
                <div style="margin-bottom: 20px;">
                  <label style="display: block; margin-bottom: 5px; color: #333;">Email:</label>
                  <input type="email" id="regEmail" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;" required>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="display: block; margin-bottom: 5px; color: #333;">Password:</label>
                  <input type="password" id="regPassword" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;" required>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="display: block; margin-bottom: 5px; color: #333;">Company Name:</label>
                  <input type="text" id="companyName" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;" required>
                </div>
                <button type="submit" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin-bottom: 10px;">Create Account</button>
                <button type="button" onclick="showSignInForm()" style="width: 100%; padding: 12px; background: #6c757d; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">Back to Sign In</button>
                <div id="status" style="margin-top: 15px; text-align: center;"></div>
              </form>
            </div>
          </div>
        `;
        
        // Add form handler
        document.getElementById('registerForm').addEventListener('submit', handleRegister);
      }
      
      async function handleSignIn(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const status = document.getElementById('status');
        
        try {
          const response = await fetch('https://novora.onrender.com/api/v1/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            status.innerHTML = '<div style="color: green;">‚úÖ Login successful! Loading dashboard...</div>';
            // Store token and redirect to dashboard
            localStorage.setItem('token', data.token);
            localStorage.setItem('user', JSON.stringify(data.user));
            setTimeout(() => showDashboard(), 1000);
          } else {
            status.innerHTML = `<div style="color: red;">‚ùå ${data.error}</div>`;
          }
        } catch (error) {
          status.innerHTML = `<div style="color: red;">‚ùå Connection error: ${error.message}</div>`;
        }
      }
      
      async function handleRegister(e) {
        e.preventDefault();
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const companyName = document.getElementById('companyName').value;
        const status = document.getElementById('status');
        
        try {
          const response = await fetch('https://novora.onrender.com/api/v1/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              email, 
              password, 
              company_name: companyName,
              company_size: 'small'
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            status.innerHTML = '<div style="color: green;">‚úÖ Account created! Loading dashboard...</div>';
            // Store token and redirect to dashboard
            localStorage.setItem('token', data.token);
            localStorage.setItem('user', JSON.stringify(data.user));
            setTimeout(() => showDashboard(), 1000);
          } else {
            status.innerHTML = `<div style="color: red;">‚ùå ${data.error}</div>`;
          }
        } catch (error) {
          status.innerHTML = `<div style="color: red;">‚ùå Connection error: ${error.message}</div>`;
        }
      }
      
      function showDashboard() {
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        const root = document.getElementById('root');
        root.innerHTML = `
          <div class="mvp-container">
            <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="color: #333; margin: 0;">Dashboard</h2>
                <button onclick="logout()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">Sign Out</button>
              </div>
              
              <div style="margin-bottom: 30px;">
                <h3 style="color: #333;">Welcome, ${user.email || 'User'}!</h3>
                <p style="color: #666;">Company: ${user.company_name || 'N/A'}</p>
              </div>
              
              <div style="margin-bottom: 30px;">
                <h3 style="color: #333;">Create New Survey</h3>
                <form id="surveyForm">
                  <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: #333;">Survey Title:</label>
                    <input type="text" id="surveyTitle" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;" required>
                  </div>
                  <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: #333;">Description:</label>
                    <textarea id="surveyDescription" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; height: 80px;" placeholder="Enter survey description"></textarea>
                  </div>
                  <button type="submit" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">Create Survey</button>
                </form>
              </div>
              
              <div>
                <h3 style="color: #333;">Your Surveys</h3>
                <div id="surveysList">Loading surveys...</div>
              </div>
            </div>
          </div>
        `;
        
        // Add form handler
        document.getElementById('surveyForm').addEventListener('submit', handleCreateSurvey);
        loadSurveys();
      }
      
      async function handleCreateSurvey(e) {
        e.preventDefault();
        const title = document.getElementById('surveyTitle').value;
        const description = document.getElementById('surveyDescription').value;
        const token = localStorage.getItem('token');
        
        try {
          const response = await fetch('https://novora.onrender.com/api/v1/surveys', {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
              title, 
              description,
              questions: [
                { type: 'text', question: 'What is your name?' },
                { type: 'rating', question: 'How satisfied are you?', scale: '1-10' }
              ]
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            document.getElementById('surveyTitle').value = '';
            document.getElementById('surveyDescription').value = '';
            loadSurveys();
          } else {
            alert('Error creating survey: ' + data.error);
          }
        } catch (error) {
          alert('Connection error: ' + error.message);
        }
      }
      
      async function loadSurveys() {
        const token = localStorage.getItem('token');
        const surveysList = document.getElementById('surveysList');
        
        try {
          const response = await fetch('https://novora.onrender.com/api/v1/surveys', {
            headers: { 'Authorization': `Bearer ${token}` }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            if (data.surveys.length === 0) {
              surveysList.innerHTML = '<p style="color: #666;">No surveys yet. Create your first survey above!</p>';
              return;
            }
            
            surveysList.innerHTML = data.surveys.map(survey => `
              <div style="border: 1px solid #ddd; padding: 20px; margin: 15px 0; border-radius: 8px; background: #f9f9f9;">
                <h4 style="color: #333; margin: 0 0 10px 0;">${survey.title}</h4>
                <p style="color: #666; margin: 0 0 15px 0;">${survey.description || 'No description'}</p>
                <div style="background: #e7f3ff; padding: 10px; border-radius: 5px;">
                  <strong>Survey Link:</strong><br>
                  <a href="${survey.survey_link}" target="_blank" style="color: #007bff; word-break: break-all;">${survey.survey_link}</a>
                </div>
              </div>
            `).join('');
          }
        } catch (error) {
          surveysList.innerHTML = '<p style="color: red;">Error loading surveys: ' + error.message + '</p>';
        }
      }
      
      function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        location.reload();
      }
      
      // Check if user is already logged in
      if (localStorage.getItem('token')) {
        showDashboard();
      }
    </script>
  </body>
</html>
